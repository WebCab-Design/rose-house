/*
	Version 1.0.5
	Alexander Elias
	Licensed Under MPL 2.0
	Copyright 2016 Alexander Elias
	https://github.com/AlexanderElias/astatine
*/
(function(){function h(a){if(!a)throw Error("ajax: requires options");a.action||(a.action=window.location.pathname);a.enctype||(a.enctype="text/plain");a.method=a.method?a.method.toUpperCase():"GET";a.data&&("GET"===a.method?(a.action=a.action+"?"+f(a.data),a.data=null):-1!==a.enctype.search("application/x-www-form-urlencoded")?a.data=f(a.data):-1!==a.enctype.search("application/json")&&(a.data=JSON.stringify(a.data)));var b=new XMLHttpRequest;b.open(a.method,a.action,!0,a.username,a.password);a.mimeType&&
b.overrideMimeType(a.mimeType);a.withCredentials&&(b.withCredentials=a.withCredentials);if(a.headers)for(var c in a.headers)b.setRequestHeader(c,a.headers[c]);b.onreadystatechange=function(){if(4===b.readyState)if(200<=b.status&&300>b.status){if(a.success)return a.success(b)}else if(a.error)return a.error(b)};b.send(a.data)}function f(a){var b="",c;for(c in a)b=0<b.length?b+"&":b,b=b+encodeURIComponent(c)+"="+encodeURIComponent(a[c]);return b}function l(a){a=a.querySelectorAll("input, textarea");
for(var b={},c=0,d=a.length;c<d;c++){var e=a[c],k=e.name,g=e.type,f=e.value,h=e.checked,e=e.disabled;k&&!e&&"submit"!==g&&"reset"!==g&&"button"!==g&&"file"!==g&&("checkbox"===g?b[k]=h:"radio"===g?h&&(b[k]=f):b[k]=f)}return b}function m(a,b){var c=document.querySelector(a),d=document.createElement("div");d.classList.add("spinner");c.appendChild(d);c.addEventListener("submit",function(a){a.preventDefault();a=a.target;var c=a.querySelector("[type=submit]");return b(a,c,d)})}window.At={setup:{spinner:{size:"3px",
thickness:"15px",colorTop:"darkgray",colorBottom:"lightgray"}},ajax:h,submit:function(a){if(!a)throw Error("submit: missing options");if(!a.query)throw Error("submit: missing options.query");m(a.query,function(b,c,d){d&&(d.style.display="block");c&&(c.style.display="none");a.data=a.data||l(b);a.action=a.action||b.getAttribute("action");a.method=a.method||b.getAttribute("method");a.enctype=a.enctype||b.getAttribute("enctype");a.headers=a.headers||{"Content-Type":a.enctype};a.prepare&&a.prepare(a.data);
a.success=function(e){d&&(d.style.display="none");c&&(c.style.display="block");b.reset();if(a.complete)return a.complete(null,e)};a.error=function(b){d&&(d.style.display="none");c&&(c.style.display="block");a.data=null;if(a.complete)return a.complete(b,null)};h(a)})},formData:l,serialize:f};document.addEventListener("load",function(){var a=document.createElement("style"),b=window.At.setup.spinner;a.innerText=".spinner {margin: auto;display: none;width: "+b.thickness+";height: "+b.thickness+";border: "+
b.size+" solid "+b.colorBottom+";border-top: "+b.size+" solid "+b.colorTop+";border-radius: 50%;animation: spin 2s linear infinite;-o-animation: spin 2s linear infinite;-moz-animation: spin 2s linear infinite;-webkit-animation: spin 2s linear infinite; }@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }@-o-keyframes spin { 0% { -o-transform: rotate(0deg); } 100% { -o-transform: rotate(360deg); } }@-moz-keyframes spin { 0% { -moz-transform: rotate(0deg); } 100% { -moz-transform: rotate(360deg); } }@-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); }100% { -webkit-transform: rotate(360deg); } }";
document.head.appendChild(a)})})();
